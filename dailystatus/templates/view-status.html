{% extends "layout.html" %}
{% block content %}
  <head>
    <script>
      $(document).ready(function() {
                  $('#project').change(function(){
                    var project = $('#project').val();

                    $.getJSON(
                      '/username' + '/' + project,
                        function(data){

                          $('#result').find('option').remove();

                          $.each(data, function(key, val) {
                          var option_item = '<option value="' + val + '">' + val + '</option>'
                          $('#result').append(option_item);
                           });
                        
                          }
                        );
                      });
                    });
    </script>
  </head>
  <header class="site-header">
      <nav class="navbar navbar-expand-md navbar-dark bg-steel fixed-top">
        <div class="container">
          <a class="navbar-brand mr-4" href="/">Daily Vector</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarToggle">
            <!-- Navbar Right Side -->
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="{{ url_for('StatusUpdate') }}">Status Update</a>
                <a class="nav-item nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <div class="content-section">
      <form class="form-horizontal" role="form" action="" method="POST">

                <table border="0" class="table table-condensed" style="margin-bottom: 0px;">
                    <tbody>
                        <tr>
                            <td width="16%"><label class="control-label">Select Project</label></td>
                            <td width="80%">
                               <select class="form-control" id="project" name="project" size=1>
                                  {{ form.project.label(class="form-control-label") }}

                                    <option >Select Project</option>

                    
                                    {% for p in choicesp %}

                                      <option value= '{{p}}' >{{p}}</option>

                                    {% endfor %}
                     
                              </select>
                            </td>
                            <td width="16%" align="right"><label class="control-label">Select Date</label></td>
                            <td width="18%">
                              {{ form.date(class="form-control form-control-lg", placeholder="yy-mm-dd") }}
                            </td>
                            <td width="8%">{{ form.submit(class="btn btn-outline-info") }}</td>
                        </tr>
                    </tbody>
                </table>
              </form>
          </div>
      {% if cc or bcc%}
        <div class="panel panel-primary" style="margin-bottom: 10px;">
            <form method="POST" method="GET">
                <table border="0" class="table table-striped" style="margin-bottom: 0px;">
                    <tbody>
                        <tr>
                            <td width="10%"><label class="control-label">To :</label></td>
                            <td>{{ form.to(class="form-control form-control-lg",value=cc.Cromail) }}</td>
                        </tr>
                        <tr>
                            <td width="10%"><label class="control-label">cc :</label></td>
                            <td>{{ form.mailcc(class="form-control form-control-lg",value=cc.mailcc) }}</td>
                        </tr>
                        <tr>
                            <td width="10%"><label class="control-label">bcc :</label></td>
                            <td>{{ form.mailbcc(class="form-control form-control-lg",value=bcc) }}</td>
                        </tr>
                        <tr>
                            <td width="10%"><label class="control-label">Subject :</label></td>
                            <td>{{ form.subject(class="form-control form-control-lg",value=cc.subject) }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
        {% endif %}
        <div class="content-section">
          <form method="POST" method="GET">
                {% if stat %}
                    <div class="content-section" style="font-family:'Tahoma'">
                      <div class="style" style="font-size: 14px;font-style: normal;font: -webkit-mini-control;padding: 0px 0px;">
                        Hi,
                        <br><br>Following are the status updates for 
                        <b>{{formatdate}}</b>,
                        <br><br>
                    {% for s in stat %}
                        <div style="height:30px;text-valign:center;">
                        <i><b>{{s.env}}:</b></i>
                        <br><br>
                        </div>
                        <div style="height:30px;text-valign:center;">
                        <b>Name : {{s.username}}</b>
                        </div>
 
                        {% for u in s['status']%}
                          {{s['status'].index(u)+1}}. <a href={{cc.ticketl+u.jira_no}}>{{u.jira_no}}:</a> {{ u['desc']}}<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;Status : <b>{{u['status']}}</b>
                            <div class="style" style="padding: 0px 0px;">
                            <ul>
                            {% for cmd in u['Comment'] %}
                            <li>{{cmd}}</li>
                            {% endfor%}
                            </ul>
                            </div>

                      {% endfor%}
<!--                         {% for u in s.status %}
				                    <p><b>{{u.jira_no}}:</b>: {{ u.desc }}</p>
                            <p><b>Status : {{u.status}}</b></p>
                            <p><ul><li>{{u.Comment}}</li></ul></p>
                        {% endfor %} -->
                    {% endfor %}
                  </div>
                  </div>
                {% endif %}
          </form>
        </div>
{% endblock content %}